<!doctype html><html><head><meta name="viewport" content="width=device-width, initial-scale=1">
<title>LED Settings</title><link rel="stylesheet" href="/static/app.css"></head>
<body>
<div class="top">
  <a href="/" class="btn">Dashboard</a>
  <a href="/reverse" class="btn">Reversing</a>
</div>

<div class="card" style="margin:1rem;max-width:680px">
  <h3>LED Ring</h3>

  <div style="display:grid;grid-template-columns:160px 1fr;gap:.6rem;align-items:center">
    <label for="enabled">Enabled</label>
    <label style="display:inline-flex;gap:.5rem;align-items:center">
      <input id="enabled" type="checkbox"> <span id="enabledText">Off</span>
    </label>

    <label for="brightness">Brightness</label>
    <input id="brightness" type="range" min="0" max="1" step="0.05" value="0.4">

    <label for="color">Colour</label>
    <input id="color" type="color" value="#ffffff" style="height:2rem;width:4rem;border:none;background:transparent">

    <label for="anim">Animation</label>
    <select id="anim">
      <option value="off">Off</option>
      <option value="white_on">Solid colour</option>
      <option value="distance_warn">Distance warn (blink colour⇄red)</option>
      <option value="pulse">Pulse (breathing)</option>
      <option value="chase">Chase (moving dot)</option>
      <option value="rainbow">Rainbow</option>
    </select>

    <label for="speed">Speed ×</label>
    <input id="speed" type="number" step="0.1" min="0.1" value="10">
  </div>

  <div style="margin-top:1rem;display:flex;gap:.6rem">
    <button id="apply" class="btn">Apply</button>
    <span id="msg" class="stat" style="font-size:1rem"></span>
  </div>
</div>

<script>
async function loadState(){
  const s = await fetch('/api/led/state',{cache:'no-store'}).then(r=>r.json());
  enabled.checked = !!s.enabled; enabledText.textContent = s.enabled ? 'On' : 'Off';
  brightness.value = s.brightness ?? 0.4;
  color.value = (s.color || '#ffffff');
  anim.value = s.anim || 'off';
  speed.value = s.speed ?? 10;
}
enabled.addEventListener('change', ()=> enabledText.textContent = enabled.checked ? 'On' : 'Off');

async function apply(){
  const body = {
    enabled: enabled.checked,
    brightness: parseFloat(brightness.value),
    color: color.value,
    anim: anim.value,
    speed: parseFloat(speed.value)
  };
  msg.textContent = 'Saving…';
  await fetch('/api/led/apply', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body)});
  msg.textContent = 'Saved ✔';
  setTimeout(()=>msg.textContent='', 1500);
}
document.getElementById('apply').onclick = apply;
loadState();
</script>
</body></html>
