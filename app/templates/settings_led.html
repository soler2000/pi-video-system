<!doctype html>
<html><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>LED Settings</title>
<link rel="stylesheet" href="{{ url_for('static', filename='app.css') }}">
</head><body>
<header class="bar"><div>ðŸ’¡ LED</div><nav><a href="{{ url_for('index') }}">Dashboard</a></nav></header>
<main class="wrap">
  <div class="card">
    <label><input type="checkbox" id="enabled"> Enabled</label>
    <div><label>Brightness <input type="range" id="brightness" min="1" max="255"></label></div>
    <div><label>Color <input type="color" id="color" value="#ffffff"></label></div>
    <div><label>Animation
      <select id="animation">
        <option value="solid">Solid</option>
        <option value="pulse">Pulse</option>
        <option value="distance_warn">Distance Warn</option>
      </select>
    </label></div>
    <button id="apply">Apply</button> <span id="msg"></span>
  </div>
</main>
<script>
(async function(){
  const g=id=>document.getElementById(id);
  async function load(){
    const s=await (await fetch('/api/led/state?ts='+Date.now(),{cache:'no-store'})).json();
    g('enabled').checked=!!s.enabled;
    g('brightness').value = s.brightness ?? 50;
    g('color').value = s.color ?? '#ffffff';
    g('animation').value = s.animation ?? 'solid';
  }
  async function apply(){
    const body={
      enabled: g('enabled').checked,
      brightness: parseInt(g('brightness').value,10),
      color: g('color').value,
      animation: g('animation').value
    };
    const r=await fetch('/api/led/apply',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});
    const j=await r.json(); g('msg').textContent = j.ok ? 'Saved' : ('Error: '+(j.error||'unknown'));
  }
  g('apply').onclick=apply;
  await load();
})();
</script>
</body></html>
