<!doctype html>
<html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Pi Video System â€” Dashboard</title>
<link rel="stylesheet" href="{{ url_for('static', filename='app.css') }}">
</head><body>
<header class="bar"><div>ðŸ“Š Dashboard</div>
<nav><a href="{{ url_for('reverse') }}">Reversing Cam</a> <a href="{{ url_for('settings_led') }}">LED</a></nav></header>
<main class="wrap"><div class="grid">
  <div class="card"><div class="t">Distance</div><div class="v" id="distance_val">â€”</div><div class="s">meters (&gt;4.0 when out of range)</div></div>
  <div class="card"><div class="t">Battery</div><div class="v"><span id="battery_percent">â€”</span></div><div class="s">Voltage: <span id="battery_voltage">â€”</span></div></div>
  <div class="card"><div class="t">CPU</div><div class="v"><span id="cpu_load">â€”</span></div><div class="s">Temp: <span id="cpu_temp">â€”</span></div></div>
  <div class="card"><div class="t">Wiâ€‘Fi</div><div class="v" id="wifi_dbm">â€”</div><div class="s">RSSI dBm</div></div>
</div><div class="s">Last update: <span id="last_update">â€”</span></div></main>
<script>
(function(){
  const set=(id,txt)=>{const el=document.getElementById(id); if(el) el.textContent=txt;};
  function fmtM(x){if(x===null||x===undefined)return 'â€”'; if(typeof x==='number')return x.toFixed(2)+' m'; if(typeof x==='string')return x.endsWith('m')?x:(x+' m'); return 'â€”';}
  async function tick(){try{const s=await (await fetch('/api/stats?ts='+Date.now(),{cache:'no-store'})).json();
    let m=(s.distance_m!==undefined)?s.distance_m:null;
    if(m===null||m===undefined){ if(typeof s.distance_cm==='number') m=(s.distance_cm/100).toFixed(2)+' m'; else m='â€”'; } else m=fmtM(m);
    set('distance_val', m);
    if(s.battery){ set('battery_percent', typeof s.battery.percent==='number'? (s.battery.percent.toFixed(0)+'%'):'â€”');
                   set('battery_voltage', typeof s.battery.voltage==='number'? (s.battery.voltage.toFixed(2)+' V'):'â€”');}
    set('cpu_temp', typeof s.cpu_temp==='number'? (s.cpu_temp.toFixed(1)+' Â°C'):'â€”');
    set('cpu_load', typeof s.cpu_load==='number'? (s.cpu_load.toFixed(0)+' %'):'â€”');
    set('wifi_dbm', typeof s.wifi_dbm==='number'? (s.wifi_dbm+' dBm'):'â€”');
    set('last_update', new Date().toLocaleTimeString());
  }catch(e){}}
  setInterval(tick,1000); tick();
})();
</script>
</body></html>
