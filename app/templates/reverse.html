<!doctype html>
<html><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Reversing Cam</title>
<link rel="stylesheet" href="{{ url_for('static', filename='app.css') }}">
<style>
#overlay { position:absolute; top:12px; left:12px; font-size:1.25em; } /* +25% */
#wrap { position:relative; }
video { width:100vw; height:100vh; object-fit:cover; background:#000; }
.badge { padding:2px 6px; border-radius:6px; background:#333; color:#fff; }
.badge.ok { background:#14b86a; }
</style>
</head><body>
<div id="wrap">
  <video id="v" autoplay muted playsinline controls></video>
  <div id="overlay">
    <span id="s" class="badge">connecting…</span>
    <span id="d" class="badge">— m</span>
  </div>
</div>
<script>
(async function(){
  const v=document.getElementById('v'); const s=document.getElementById('s'); const d=document.getElementById('d');
  async function updateD(){
    try{
      const j=await (await fetch('/api/stats?ts='+Date.now(),{cache:'no-store'})).json();
      let m=j.distance_m;
      if(typeof m==='number') d.textContent=m.toFixed(2)+' m';
      else if(typeof m==='string') d.textContent=m+' m';
      else d.textContent='— m';
    }catch(e){}
  }
  setInterval(updateD, 500); updateD();
  try{
    const j=await (await fetch('/api/stats')).json();
    s.textContent='live (HLS)'; s.className='badge ok';
    v.src=j.hls; v.play().catch(()=>{});
  }catch(e){ s.textContent='error'; }
})();
</script>
</body></html>
